version: '2'

services:
  ca0:
    image: registry.cn-beijing.aliyuncs.com/lovetcn/fabric:ca-patch-0507
    environment:
      - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server
    ports:
      - "7054:7054"
    command: sh -c 'fabric-ca-server start -b admin:adminpw'
    container_name: ca0

  orderer0:
    container_name: orderer0
    image: hyperledger/fabric-orderer
    environment:
      - GRPC_TRACE=all=true,  
      - GRPC_VERBOSITY=debug
      - ORDERER_GENERAL_LOGLEVEL=debug
      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0
      - ORDERER_GENERAL_GENESISMETHOD=file
      - ORDERER_GENERAL_GENESISFILE=/etc/hyperledger/configtx/twoorgs.orderer.block
      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP
      - ORDERER_GENERAL_LOCALMSPDIR=/etc/hyperledger/msp/orderer
      - ORDERER_GENERAL_TLS_ENABLED=false
    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/orderer
    command: orderer
    ports:
      - 7050:7050

  cconsole:
    container_name: chain-console
    image: registry.cn-beijing.aliyuncs.com/lovetcn/fabric:cconsole-361d5de
    environment:
      - FABRIC_CA_SERVER_URL=http://ca0:7054
      - FABRIC_ORDERER_ENDPOINT=grpc://orderer0:7050
    command: java -jar chain-console/cconsole-1.0.jar
    ports:
      - 9494:9494
    depends_on:
      - ca0
      - orderer0
